apiVersion: v1
kind: ConfigMap
metadata:
  name: cloudflared-config
  namespace: cloudflared
data:
  config.yaml: |
    # Ingress rules for routing traffic from Cloudflare Tunnel to Kubernetes services
    ingress:
      # Route all *.taya.net subdomains to Cilium ingress controller NodePort
      # Multiple origins for HA - cloudflared will load balance and failover between them
      - hostname: "*.taya.net"
        service: http://192.168.178.101:31267
        originRequest:
          connectTimeout: 10s
          noTLSVerify: true
      - hostname: "*.taya.net"
        service: http://192.168.178.102:31267
        originRequest:
          connectTimeout: 10s
          noTLSVerify: true
      - hostname: "*.taya.net"
        service: http://192.168.178.103:31267
        originRequest:
          connectTimeout: 10s
          noTLSVerify: true
      - hostname: "*.taya.net"
        service: http://192.168.178.104:31267
        originRequest:
          connectTimeout: 10s
          noTLSVerify: true
      
      # Catch-all rule (required by cloudflared)
      - service: http_status:404
